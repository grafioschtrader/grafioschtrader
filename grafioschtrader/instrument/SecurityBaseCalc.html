<!DOCTYPE HTML>
<html lang>
<head>
<!-- Generated by javadoc (21) on Thu Jul 24 13:13:36 UTC 2025 -->
<title>SecurityBaseCalc (grafioschtrader 0.33.8 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2025-07-24">
<meta name="description" content="declaration: package: grafioschtrader.instrument, class: SecurityBaseCalc">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/SecurityBaseCalc.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li><a href="#nested-class-summary">Nested</a></li>
<li>Field</li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">grafioschtrader.instrument</a></div>
<h1 title="Class SecurityBaseCalc" class="title">Class SecurityBaseCalc</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">grafioschtrader.instrument.SecurityBaseCalc</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>Direct Known Subclasses:</dt>
<dd><code><a href="SecurityGeneralCalc.html" title="class in grafioschtrader.instrument">SecurityGeneralCalc</a></code>, <code><a href="SecurityMarginCalc.html" title="class in grafioschtrader.instrument">SecurityMarginCalc</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public abstract class </span><span class="element-name type-name-label">SecurityBaseCalc</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">Abstract base class for security transaction calculations and portfolio position management.
 
 <p>
 This class provides the foundation for calculating gains, losses, and position summaries for various types of
 securities including stocks, bonds, ETFs, and margin instruments. It implements the Template Method pattern, defining
 the skeleton of calculation algorithms while allowing subclasses to customize specific aspects for different
 instrument types.
 </p>
 
 <h3 id="core-responsibilities--heading">Core Responsibilities:</h3>
 <ul>
 <li><strong>Transaction Processing:</strong> Handles individual security transactions and their impact on portfolio
 positions</li>
 <li><strong>Position Calculation:</strong> Maintains running calculations of units, cost basis, and gain/loss for
 security positions</li>
 <li><strong>Currency Conversion:</strong> Manages multi-currency calculations using historical and current exchange
 rates</li>
 <li><strong>Corporate Actions:</strong> Accounts for security splits and other corporate actions in position
 calculations</li>
 <li><strong>Hypothetical Scenarios:</strong> Creates simulated transactions for position analysis and reporting</li>
 </ul>
 
 <h3 id="calculation-methodology--heading">Calculation Methodology:</h3>
 <p>
 The class employs different calculation strategies based on instrument type:
 </p>
 <ul>
 <li><strong>Standard Securities:</strong> Uses average cost method for position tracking</li>
 <li><strong>Margin Instruments:</strong> Employs specific position tracking for leveraged products</li>
 <li><strong>Multi-Currency:</strong> Converts all values to a main currency for consolidated reporting</li>
 </ul>
 
 <h3 id="subclass-implementation--heading">Subclass Implementation:</h3>
 <p>
 Concrete subclasses must implement instrument-specific calculation logic:
 </p>
 <ul>
 <li><a href="SecurityGeneralCalc.html" title="class in grafioschtrader.instrument"><code>SecurityGeneralCalc</code></a> - For standard securities (stocks, bonds, ETFs)</li>
 <li><a href="SecurityMarginCalc.html" title="class in grafioschtrader.instrument"><code>SecurityMarginCalc</code></a> - For margin instruments (CFDs, Forex)</li>
 </ul>
 
 <h3 id="transaction-flow--heading">Transaction Flow:</h3>
 <p>
 Typical usage involves processing transactions in chronological order, where each transaction updates the position
 summary with new units, costs, and gain/loss calculations. The class handles complex scenarios including partial
 position closures, dividend payments, and currency conversions.
 </p>
 
 <h3 id="thread-safety--heading">Thread Safety:</h3>
 <p>
 This class is not thread-safe. Instances should not be shared across multiple threads without external
 synchronization. Each calculation sequence should use a dedicated instance or proper synchronization.
 </p></div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>protected static class&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="SecurityBaseCalc.CalcTransactionPos.html" class="type-name-link" title="class in grafioschtrader.instrument">SecurityBaseCalc.CalcTransactionPos</a></code></div>
<div class="col-last even-row-color">
<div class="block">Calculation context object that encapsulates all parameters needed for processing a single transaction.</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">SecurityBaseCalc</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../entities/Transaction.html" title="class in grafioschtrader.entities">Transaction</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#createHypotheticalBuySellTransaction(grafioschtrader.types.TransactionType,grafioschtrader.reportviews.securityaccount.SecurityPositionSummary,double,grafioschtrader.config.NegativeIdNumberCreater)" class="member-name-link">createHypotheticalBuySellTransaction</a><wbr>(<a href="../types/TransactionType.html" title="enum class in grafioschtrader.types">TransactionType</a>&nbsp;transactionType,
 <a href="../reportviews/securityaccount/SecurityPositionSummary.html" title="class in grafioschtrader.reportviews.securityaccount">SecurityPositionSummary</a>&nbsp;securityPositionSummary,
 double&nbsp;lastPrice,
 <a href="../config/NegativeIdNumberCreater.html" title="class in grafioschtrader.config">NegativeIdNumberCreater</a>&nbsp;negativeIdNumberCreater)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Creates a hypothetical buy or sell transaction for position analysis.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="SecurityBaseCalc.CalcTransactionPos.html" title="class in grafioschtrader.instrument">SecurityBaseCalc.CalcTransactionPos</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#initTransactionCalcTransCost(grafioschtrader.entities.Transaction,grafioschtrader.reportviews.securityaccount.SecurityPositionSummary,java.util.Map,grafioschtrader.reportviews.DateTransactionCurrencypairMap,grafioschtrader.entities.Transaction)" class="member-name-link">initTransactionCalcTransCost</a><wbr>(<a href="../entities/Transaction.html" title="class in grafioschtrader.entities">Transaction</a>&nbsp;transaction,
 <a href="../reportviews/securityaccount/SecurityPositionSummary.html" title="class in grafioschtrader.reportviews.securityaccount">SecurityPositionSummary</a>&nbsp;securityPositionSummary,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="../entities/Securitysplit.html" title="class in grafioschtrader.entities">Securitysplit</a>&gt;&gt;&nbsp;securitysplitMap,
 <a href="../reportviews/DateTransactionCurrencypairMap.html" title="class in grafioschtrader.reportviews">DateTransactionCurrencypairMap</a>&nbsp;dateCurrencyMap,
 <a href="../entities/Transaction.html" title="class in grafioschtrader.entities">Transaction</a>&nbsp;openMarginTransaction)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Initializes transaction calculation parameters including split factors and exchange rates.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>SecurityBaseCalc</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">SecurityBaseCalc</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="initTransactionCalcTransCost(grafioschtrader.entities.Transaction,grafioschtrader.reportviews.securityaccount.SecurityPositionSummary,java.util.Map,grafioschtrader.reportviews.DateTransactionCurrencypairMap,grafioschtrader.entities.Transaction)">
<h3>initTransactionCalcTransCost</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="SecurityBaseCalc.CalcTransactionPos.html" title="class in grafioschtrader.instrument">SecurityBaseCalc.CalcTransactionPos</a></span>&nbsp;<span class="element-name">initTransactionCalcTransCost</span><wbr><span class="parameters">(<a href="../entities/Transaction.html" title="class in grafioschtrader.entities">Transaction</a>&nbsp;transaction,
 <a href="../reportviews/securityaccount/SecurityPositionSummary.html" title="class in grafioschtrader.reportviews.securityaccount">SecurityPositionSummary</a>&nbsp;securityPositionSummary,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="../entities/Securitysplit.html" title="class in grafioschtrader.entities">Securitysplit</a>&gt;&gt;&nbsp;securitysplitMap,
 <a href="../reportviews/DateTransactionCurrencypairMap.html" title="class in grafioschtrader.reportviews">DateTransactionCurrencypairMap</a>&nbsp;dateCurrencyMap,
 <a href="../entities/Transaction.html" title="class in grafioschtrader.entities">Transaction</a>&nbsp;openMarginTransaction)</span></div>
<div class="block">Initializes transaction calculation parameters including split factors and exchange rates.
 
 <p>
 This method performs the preliminary calculations needed for transaction processing, including: determining
 appropriate split factors for corporate actions, calculating exchange rates for currency conversions, and setting
 up the calculation context for the specific transaction type.
 </p>
 
 <h4 id="split-factor-calculation--heading">Split Factor Calculation:</h4>
 <p>
 The method calculates split factors to ensure historical transactions remain accurate after corporate actions. For
 margin instruments with connected transactions, it calculates the split factor from the original opening
 transaction to maintain position integrity.
 </p>
 
 <h4 id="exchange-rate-handling--heading">Exchange Rate Handling:</h4>
 <p>
 Determines the appropriate exchange rate for currency conversion based on transaction date, security currency, cash
 account currency, and the portfolio's main currency.
 </p></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>transaction</code> - the transaction being processed</dd>
<dd><code>securityPositionSummary</code> - the position summary being updated</dd>
<dd><code>securitysplitMap</code> - map of security splits for corporate action adjustments</dd>
<dd><code>dateCurrencyMap</code> - currency exchange rate data and main currency information</dd>
<dd><code>openMarginTransaction</code> - the original opening transaction for margin position closures, or <code>null</code></dd>
<dt>Returns:</dt>
<dd>calculation parameters object containing exchange rates, split factors, and adjusted values</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="createHypotheticalBuySellTransaction(grafioschtrader.types.TransactionType,grafioschtrader.reportviews.securityaccount.SecurityPositionSummary,double,grafioschtrader.config.NegativeIdNumberCreater)">
<h3>createHypotheticalBuySellTransaction</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../entities/Transaction.html" title="class in grafioschtrader.entities">Transaction</a></span>&nbsp;<span class="element-name">createHypotheticalBuySellTransaction</span><wbr><span class="parameters">(<a href="../types/TransactionType.html" title="enum class in grafioschtrader.types">TransactionType</a>&nbsp;transactionType,
 <a href="../reportviews/securityaccount/SecurityPositionSummary.html" title="class in grafioschtrader.reportviews.securityaccount">SecurityPositionSummary</a>&nbsp;securityPositionSummary,
 double&nbsp;lastPrice,
 <a href="../config/NegativeIdNumberCreater.html" title="class in grafioschtrader.config">NegativeIdNumberCreater</a>&nbsp;negativeIdNumberCreater)</span></div>
<div class="block">Creates a hypothetical buy or sell transaction for position analysis.
 
 <p>
 This utility method generates simulated transactions that can be used for what-if analysis, portfolio valuation,
 and position closure simulations. The created transaction contains realistic values based on current market
 conditions and position details.
 </p>
 
 <h4 id="transaction-properties--heading">Transaction Properties:</h4>
 <ul>
 <li><strong>Negative ID:</strong> Uses negative transaction IDs to distinguish from real transactions</li>
 <li><strong>Current Date:</strong> Uses the current system time as the transaction time</li>
 <li><strong>Market Price:</strong> Uses the provided last price for valuation</li>
 <li><strong>Currency Matching:</strong> Creates cash account in security's currency</li>
 </ul>
 
 <h4 id="calculated-values--heading">Calculated Values:</h4>
 <p>
 The cash account amount is calculated as the product of units and last price, representing the gross proceeds (for
 sells) or cost (for buys) before considering transaction costs or taxes.
 </p></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>transactionType</code> - the type of hypothetical transaction (<a href="../types/TransactionType.html#HYPOTHETICAL_BUY"><code>TransactionType.HYPOTHETICAL_BUY</code></a> or
                                <a href="../types/TransactionType.html#HYPOTHETICAL_SELL"><code>TransactionType.HYPOTHETICAL_SELL</code></a>)</dd>
<dd><code>securityPositionSummary</code> - the position summary containing units and security information</dd>
<dd><code>lastPrice</code> - the current market price to use for the transaction</dd>
<dd><code>negativeIdNumberCreater</code> - utility for generating unique negative transaction IDs</dd>
<dt>Returns:</dt>
<dd>a fully configured hypothetical transaction ready for calculation processing</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2025 grafioschtrader. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
